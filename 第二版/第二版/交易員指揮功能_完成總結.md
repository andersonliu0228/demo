# äº¤æ˜“å“¡æŒ‡æ®åŠŸèƒ½ - å®Œæˆç¸½çµ

## âœ… å·²å®ŒæˆåŠŸèƒ½

### å¾Œç«¯ API ç«¯é»

#### 1. GET /api/v1/trader/clients
**åŠŸèƒ½**: ç²å–äº¤æ˜“å“¡åä¸‹çš„æ‰€æœ‰å®¢æˆ¶ï¼ˆè·Ÿéš¨è€…ï¼‰

**å›å‚³è³‡æ–™**:
- `id`: å®¢æˆ¶ ID
- `relation_id`: è·Ÿå–®é—œä¿‚ ID
- `username`: å®¢æˆ¶ç”¨æˆ¶å
- `email`: å®¢æˆ¶éƒµç®±
- `copy_ratio`: è·Ÿå–®å€ç‡
- `status`: ç‹€æ…‹ (active/pending/blocked)
- `net_value`: å¸³æˆ¶ç¸½å€¼ (USDT)
- `created_at`: å‰µå»ºæ™‚é–“

**èªè­‰**: éœ€è¦ JWT Token (Bearer Token)

#### 2. PATCH /api/v1/trader/update-client
**åŠŸèƒ½**: æ›´æ–°å®¢æˆ¶çš„è·Ÿå–®å€ç‡å’Œç‹€æ…‹

**è«‹æ±‚åƒæ•¸**:
```json
{
  "relation_id": 1,
  "copy_ratio": 2.5,  // å¯é¸
  "status": "active"   // å¯é¸: active/pending/blocked
}
```

**å›å‚³è³‡æ–™**:
```json
{
  "message": "å®¢æˆ¶è¨­å®šå·²æ›´æ–°",
  "relation_id": 1,
  "copy_ratio": 2.5,
  "status": "active"
}
```

**èªè­‰**: éœ€è¦ JWT Token (Bearer Token)

### å‰ç«¯åŠŸèƒ½

#### 1. è³‡æ–™æŠ“å–èˆ‡é¡¯ç¤º
- âœ… å¾å¾Œç«¯ API ç²å–çœŸå¯¦å®¢æˆ¶è³‡æ–™
- âœ… è‡ªå‹•å¾ localStorage è®€å– access_token
- âœ… æ­£ç¢ºè¨­ç½® Authorization Header
- âœ… é¡¯ç¤ºå®¢æˆ¶åˆ—è¡¨ï¼ˆç”¨æˆ¶åã€éƒµç®±ã€å€ç‡ã€ç‹€æ…‹ã€ç¸½è³‡ç”¢ï¼‰

#### 2. å³æ™‚æ§åˆ¶åŠŸèƒ½
- âœ… **è·Ÿå–®å€ç‡ç·¨è¼¯**: è¼¸å…¥æ¡†å¤±ç„¦æ™‚è‡ªå‹•ä¿å­˜åˆ°å¾Œç«¯
- âœ… **ç‹€æ…‹åˆ‡æ›**: å•Ÿç”¨/å°é–/è§£é™¤å°é–æŒ‰éˆ•
- âœ… **å³æ™‚æ›´æ–°**: æœ¬åœ°ç‹€æ…‹ç«‹å³æ›´æ–°ï¼Œæä¾›æµæš¢é«”é©—

#### 3. è¦–è¦ºå›é¥‹
- âœ… Loading ç‹€æ…‹é¡¯ç¤ºï¼ˆè¼‰å…¥ä¸­...ï¼‰
- âœ… éŒ¯èª¤è¨Šæ¯æç¤º
- âœ… **æœ€å¾Œæ›´æ–°æ™‚é–“**: é¡¯ç¤ºåœ¨æ¨™é¡Œä¸‹æ–¹
- âœ… **æ‰‹å‹•åˆ·æ–°æŒ‰éˆ•**: å¯éš¨æ™‚é‡æ–°è¼‰å…¥è³‡æ–™
- âœ… ç©ºç‹€æ…‹æç¤º

#### 4. æœå°‹èˆ‡ç¯©é¸
- âœ… æœå°‹å®¢æˆ¶ï¼ˆç”¨æˆ¶åæˆ–éƒµç®±ï¼‰
- âœ… ç‹€æ…‹ç¯©é¸ï¼ˆå…¨éƒ¨/å•Ÿç”¨ä¸­/å¾…å¯©æ ¸/å·²å°é–ï¼‰
- âœ… å³æ™‚çµ±è¨ˆå¡ç‰‡ï¼ˆç¸½å®¢æˆ¶æ•¸ã€å„ç‹€æ…‹æ•¸é‡ã€ç¸½è³‡ç”¢ï¼‰

## ğŸ§ª æ¸¬è©¦çµæœ

### API æ¸¬è©¦
```powershell
# é‹è¡Œå®Œæ•´æ¸¬è©¦
.\test-trader-admin-complete.ps1
```

**æ¸¬è©¦é …ç›®**:
1. âœ… ç™»å…¥èªè­‰
2. âœ… ç²å–å®¢æˆ¶åˆ—è¡¨ï¼ˆ3å€‹æ¸¬è©¦å®¢æˆ¶ï¼‰
3. âœ… æ›´æ–°è·Ÿå–®å€ç‡ï¼ˆ1.5x â†’ 2.5xï¼‰
4. âœ… åˆ‡æ›ç‹€æ…‹ï¼ˆactive â†’ blocked â†’ activeï¼‰
5. âœ… é©—è­‰æ›´æ–°çµæœ

**æ¸¬è©¦çµæœ**: å…¨éƒ¨é€šé âœ…

### å‰ç«¯æ¸¬è©¦
1. è¨ªå• `http://localhost:3000/login`
2. ä½¿ç”¨å¸³è™Ÿï¼š`testuser` / å¯†ç¢¼ï¼š`testpass123`
3. ç™»å…¥å¾Œè¨ªå• `http://localhost:3000/admin`
4. æ¸¬è©¦åŠŸèƒ½ï¼š
   - âœ… æŸ¥çœ‹å®¢æˆ¶åˆ—è¡¨
   - âœ… ä¿®æ”¹è·Ÿå–®å€ç‡
   - âœ… åˆ‡æ›å®¢æˆ¶ç‹€æ…‹
   - âœ… æœå°‹å’Œç¯©é¸
   - âœ… æ‰‹å‹•åˆ·æ–°

## ğŸ“Š è³‡æ–™åº«çµæ§‹

### follower_relations è¡¨
```sql
- id: é—œä¿‚ ID
- master_id: äº¤æ˜“å“¡ ID (å¤–éµ -> users.id)
- follower_id: è·Ÿéš¨è€… ID (å¤–éµ -> users.id)
- copy_ratio: è·Ÿå–®å€ç‡ (float)
- status: ç‹€æ…‹ (active/pending/blocked)
- created_at: å‰µå»ºæ™‚é–“
- updated_at: æ›´æ–°æ™‚é–“
```

### æ¸¬è©¦è³‡æ–™
- **Master**: testuser (ID: 1)
- **Followers**:
  - follower1 (ID: 2) - å€ç‡: 2.5x, ç‹€æ…‹: active
  - follower2 (ID: 3) - å€ç‡: 0.5x, ç‹€æ…‹: pending
  - follower3 (ID: 4) - å€ç‡: 2.0x, ç‹€æ…‹: blocked

## ğŸ” å®‰å…¨æ€§

- âœ… JWT Token èªè­‰
- âœ… åªèƒ½ç®¡ç†è‡ªå·±çš„å®¢æˆ¶ï¼ˆmaster_id é©—è­‰ï¼‰
- âœ… è¼¸å…¥é©—è­‰ï¼ˆå€ç‡ä¸èƒ½ç‚ºè² æ•¸ï¼‰
- âœ… ç‹€æ…‹é©—è­‰ï¼ˆåªå…è¨±æœ‰æ•ˆç‹€æ…‹å€¼ï¼‰

## ğŸš€ ä½¿ç”¨æ–¹å¼

### å•Ÿå‹•ç³»çµ±
```bash
# å•Ÿå‹•æ‰€æœ‰æœå‹™
docker-compose up -d

# æˆ–ä½¿ç”¨è…³æœ¬
.\docker-start.ps1
```

### å‰µå»ºæ¸¬è©¦è³‡æ–™
```bash
# å‰µå»ºæ¸¬è©¦ç”¨æˆ¶å’Œè·Ÿå–®é—œä¿‚
docker-compose exec backend python -c "
import asyncio
from sqlalchemy import select
from backend.app.database import AsyncSessionLocal
from backend.app.models.user import User
from backend.app.models.follower_relation import FollowerRelation
from backend.app.services.auth_service import AuthService

async def main():
    async with AsyncSessionLocal() as session:
        # å‰µå»º followers å’Œ relations
        # (è©³è¦‹ scripts/create_test_relations.py)
        pass

asyncio.run(main())
"
```

### æ¸¬è©¦ API
```powershell
# å®Œæ•´åŠŸèƒ½æ¸¬è©¦
.\test-trader-admin-complete.ps1

# æˆ–å–®ç¨æ¸¬è©¦
.\test-trader-admin-api.ps1
```

## ğŸ“ API ä½¿ç”¨ç¯„ä¾‹

### ç²å–å®¢æˆ¶åˆ—è¡¨
```bash
curl -X GET http://localhost:8000/api/v1/trader/clients \
  -H "Authorization: Bearer YOUR_TOKEN"
```

### æ›´æ–°è·Ÿå–®å€ç‡
```bash
curl -X PATCH http://localhost:8000/api/v1/trader/update-client \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "relation_id": 1,
    "copy_ratio": 2.5
  }'
```

### åˆ‡æ›å®¢æˆ¶ç‹€æ…‹
```bash
curl -X PATCH http://localhost:8000/api/v1/trader/update-client \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "relation_id": 1,
    "status": "blocked"
  }'
```

## ğŸ¯ ä¸‹ä¸€æ­¥

å¯ä»¥è€ƒæ…®çš„æ“´å±•åŠŸèƒ½ï¼š
1. æ‰¹é‡æ“ä½œï¼ˆæ‰¹é‡å•Ÿç”¨/å°é–ï¼‰
2. å®¢æˆ¶ç¸¾æ•ˆçµ±è¨ˆï¼ˆPnLã€å‹ç‡ç­‰ï¼‰
3. è·Ÿå–®æ­·å²è¨˜éŒ„
4. å¯¦æ™‚é€šçŸ¥ï¼ˆWebSocketï¼‰
5. å°å‡ºå®¢æˆ¶è³‡æ–™ï¼ˆCSV/Excelï¼‰
6. å®¢æˆ¶åˆ†çµ„ç®¡ç†

## ğŸ“ æ”¯æ´

å¦‚æœ‰å•é¡Œï¼Œè«‹æŸ¥çœ‹ï¼š
- `QUICK_REFERENCE.md` - å¿«é€Ÿåƒè€ƒæŒ‡å—
- `SWAGGER_æ¸¬è©¦æŒ‡å—.md` - API æ–‡æª”
- `å®Œæ•´ç³»çµ±å¿«é€Ÿå•Ÿå‹•æŒ‡å—.md` - ç³»çµ±å•Ÿå‹•æŒ‡å—

---

**ç‹€æ…‹**: âœ… å®Œæˆä¸¦æ¸¬è©¦é€šé
**æ—¥æœŸ**: 2026-02-04
**ç‰ˆæœ¬**: 1.0.0
