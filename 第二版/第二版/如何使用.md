# EA è‡ªå‹•åŒ–è·Ÿå–®ç³»çµ±å¾Œç«¯ - ä½¿ç”¨æŒ‡å—

## å¿«é€Ÿé–‹å§‹ï¼ˆ3 æ­¥é©Ÿï¼‰

### æ­¥é©Ÿ 1ï¼šç”ŸæˆåŠ å¯†é‡‘é‘°

åœ¨ PowerShell ä¸­åŸ·è¡Œï¼š

```powershell
# ç”ŸæˆåŠ å¯†é‡‘é‘°
python scripts/generate_encryption_key.py
```

é€™æœƒç”Ÿæˆä¸€å€‹é¡ä¼¼é€™æ¨£çš„é‡‘é‘°ï¼š
```
your-generated-key-here-base64-encoded
```

**é‡è¦**ï¼šè¤‡è£½é€™å€‹é‡‘é‘°ï¼Œä¸‹ä¸€æ­¥æœƒç”¨åˆ°ï¼

### æ­¥é©Ÿ 2ï¼šè¨­å®šç’°å¢ƒè®Šæ•¸

å‰µå»º `.env` æ–‡ä»¶ï¼ˆè¤‡è£½ `.env.example`ï¼‰ï¼š

```powershell
copy .env.example .env
```

ç·¨è¼¯ `.env` æ–‡ä»¶ï¼Œå¡«å…¥å‰›æ‰ç”Ÿæˆçš„åŠ å¯†é‡‘é‘°ï¼š

```env
# è³‡æ–™åº«é…ç½®
DATABASE_URL=postgresql+asyncpg://postgres:postgres@postgres:5432/ea_trading

# Redis é…ç½®
REDIS_URL=redis://redis:6379/0

# åŠ å¯†é‡‘é‘°ï¼ˆå¡«å…¥æ­¥é©Ÿ 1 ç”Ÿæˆçš„é‡‘é‘°ï¼‰
ENCRYPTION_KEY=your-generated-key-here-base64-encoded

# æ‡‰ç”¨ç¨‹å¼é…ç½®
APP_ENV=development
DEBUG=True
LOG_LEVEL=INFO
```

### æ­¥é©Ÿ 3ï¼šå•Ÿå‹•æœå‹™

```powershell
# å•Ÿå‹•æ‰€æœ‰æœå‹™ï¼ˆPostgreSQL + Redis + å¾Œç«¯ï¼‰
docker compose up -d

# æŸ¥çœ‹æ—¥èªŒ
docker compose logs -f backend
```

ç­‰å¾…å¹¾ç§’é˜ï¼Œç›´åˆ°çœ‹åˆ°ï¼š
```
INFO:     Uvicorn running on http://0.0.0.0:8000
```

## é©—è­‰ç³»çµ±é‹è¡Œ

### 1. æª¢æŸ¥å¥åº·ç‹€æ…‹

åœ¨ç€è¦½å™¨æ‰“é–‹ï¼š
```
http://localhost:8000/health
```

æ‡‰è©²çœ‹åˆ°ï¼š
```json
{
  "status": "healthy",
  "timestamp": "2026-02-03T13:00:00"
}
```

### 2. æŸ¥çœ‹ API æ–‡æª”

åœ¨ç€è¦½å™¨æ‰“é–‹ï¼š
```
http://localhost:8000/docs
```

é€™æœƒé¡¯ç¤ºå®Œæ•´çš„ API æ–‡æª”ï¼ˆSwagger UIï¼‰ã€‚

## ä½¿ç”¨ API

### 1. ç²å–æ”¯æ´çš„äº¤æ˜“æ‰€åˆ—è¡¨

```powershell
curl http://localhost:8000/api/v1/exchange/supported
```

å›æ‡‰ï¼š
```json
["binance", "okx", "bybit", "huobi", "kucoin", "gate", "bitget", "mexc"]
```

### 2. é©—è­‰ API æ†‘è­‰ï¼ˆä¸å„²å­˜ï¼‰

```powershell
curl -X POST http://localhost:8000/api/v1/exchange/verify `
  -H "Content-Type: application/json" `
  -d '{
    "exchange_name": "binance",
    "api_key": "your_api_key",
    "api_secret": "your_api_secret"
  }'
```

å›æ‡‰ï¼š
```json
{
  "is_valid": true,
  "has_trading_permission": true,
  "account_info": {
    "balance": 1000.0
  },
  "error_message": null
}
```

### 3. ç¶å®š API æ†‘è­‰

```powershell
curl -X POST http://localhost:8000/api/v1/credentials `
  -H "Content-Type: application/json" `
  -d '{
    "exchange_name": "binance",
    "api_key": "your_api_key",
    "api_secret": "your_api_secret",
    "verify": true
  }'
```

å›æ‡‰ï¼š
```json
{
  "id": 1,
  "exchange_name": "binance",
  "api_key_masked": "your...key",
  "is_active": true,
  "last_verified_at": "2026-02-03T13:00:00",
  "created_at": "2026-02-03T13:00:00",
  "updated_at": "2026-02-03T13:00:00"
}
```

### 4. æŸ¥è©¢å·²ç¶å®šçš„æ†‘è­‰

```powershell
curl http://localhost:8000/api/v1/credentials
```

### 5. æ›´æ–°æ†‘è­‰

```powershell
curl -X PUT http://localhost:8000/api/v1/credentials/1 `
  -H "Content-Type: application/json" `
  -d '{
    "api_key": "new_api_key",
    "api_secret": "new_api_secret",
    "verify": true
  }'
```

### 6. åˆªé™¤æ†‘è­‰

```powershell
curl -X DELETE http://localhost:8000/api/v1/credentials/1
```

## å¸¸ç”¨å‘½ä»¤

### æŸ¥çœ‹æœå‹™ç‹€æ…‹

```powershell
docker compose ps
```

### æŸ¥çœ‹æ—¥èªŒ

```powershell
# æŸ¥çœ‹æ‰€æœ‰æœå‹™æ—¥èªŒ
docker compose logs -f

# åªæŸ¥çœ‹å¾Œç«¯æ—¥èªŒ
docker compose logs -f backend

# åªæŸ¥çœ‹æœ€å¾Œ 100 è¡Œ
docker compose logs --tail=100 backend
```

### é‡å•Ÿæœå‹™

```powershell
# é‡å•Ÿå¾Œç«¯
docker compose restart backend

# é‡å•Ÿæ‰€æœ‰æœå‹™
docker compose restart
```

### åœæ­¢æœå‹™

```powershell
# åœæ­¢æ‰€æœ‰æœå‹™
docker compose down

# åœæ­¢ä¸¦åˆªé™¤æ•¸æ“šå·ï¼ˆæ¸…ç©ºè³‡æ–™åº«ï¼‰
docker compose down -v
```

### é€²å…¥å®¹å™¨

```powershell
# é€²å…¥å¾Œç«¯å®¹å™¨
docker compose exec backend bash

# åœ¨å®¹å™¨ä¸­åŸ·è¡Œ Python
docker compose exec backend python

# åœ¨å®¹å™¨ä¸­åŸ·è¡Œè³‡æ–™åº«é·ç§»
docker compose exec backend alembic upgrade head
```

## è³‡æ–™åº«ç®¡ç†

### æŸ¥çœ‹è³‡æ–™åº«

```powershell
# é€£æ¥åˆ° PostgreSQL
docker compose exec postgres psql -U postgres -d ea_trading

# æŸ¥çœ‹æ‰€æœ‰è¡¨
\dt

# æŸ¥çœ‹ç”¨æˆ¶è¡¨
SELECT * FROM users;

# æŸ¥çœ‹æ†‘è­‰è¡¨
SELECT * FROM api_credentials;

# é€€å‡º
\q
```

### åŸ·è¡Œè³‡æ–™åº«é·ç§»

```powershell
# å‡ç´šåˆ°æœ€æ–°ç‰ˆæœ¬
docker compose exec backend alembic upgrade head

# æŸ¥çœ‹é·ç§»æ­·å²
docker compose exec backend alembic history

# å›æ»¾åˆ°ä¸Šä¸€å€‹ç‰ˆæœ¬
docker compose exec backend alembic downgrade -1
```

### å‰µå»ºæ–°çš„é·ç§»

```powershell
docker compose exec backend alembic revision --autogenerate -m "æè¿°è®Šæ›´"
```

## é–‹ç™¼æ¨¡å¼

### ä¿®æ”¹ä»£ç¢¼å¾Œé‡æ–°è¼‰å…¥

ä»£ç¢¼å·²ç¶“æ›è¼‰åˆ°å®¹å™¨ä¸­ï¼Œä¿®æ”¹å¾Œæœƒè‡ªå‹•é‡æ–°è¼‰å…¥ï¼ˆç†±é‡è¼‰ï¼‰ã€‚

å¦‚æœéœ€è¦æ‰‹å‹•é‡å•Ÿï¼š

```powershell
docker compose restart backend
```

### å®‰è£æ–°çš„ä¾è³´

1. ä¿®æ”¹ `requirements.txt`
2. é‡æ–°æ§‹å»ºé¡åƒï¼š

```powershell
docker compose build backend
docker compose up -d backend
```

## æ¸¬è©¦

### é‹è¡Œæ‰€æœ‰æ¸¬è©¦

```powershell
docker compose exec backend pytest backend/tests/ -v
```

### é‹è¡Œç‰¹å®šæ¸¬è©¦

```powershell
# é‹è¡Œå±¬æ€§æ¸¬è©¦
docker compose exec backend pytest backend/tests/ -v -k "property"

# é‹è¡Œå–®å…ƒæ¸¬è©¦
docker compose exec backend pytest backend/tests/ -v -k "not property"

# é‹è¡Œç‰¹å®šæ–‡ä»¶
docker compose exec backend pytest backend/tests/services/test_crypto_service.py -v
```

### ç”Ÿæˆæ¸¬è©¦è¦†è“‹ç‡å ±å‘Š

```powershell
docker compose exec backend pytest backend/tests/ --cov=backend/app --cov-report=html
```

å ±å‘Šæœƒç”Ÿæˆåœ¨ `htmlcov/index.html`ã€‚

## æ•…éšœæ’é™¤

### å•é¡Œ 1ï¼šç«¯å£è¢«ä½”ç”¨

**éŒ¯èª¤**ï¼š`Bind for 0.0.0.0:8000 failed: port is already allocated`

**è§£æ±ºæ–¹æ³•**ï¼š
```powershell
# æŸ¥çœ‹ä½”ç”¨ç«¯å£çš„é€²ç¨‹
netstat -ano | findstr :8000

# ä¿®æ”¹ docker-compose.yml ä¸­çš„ç«¯å£æ˜ å°„
# å°‡ "8000:8000" æ”¹ç‚º "8001:8000"
```

### å•é¡Œ 2ï¼šè³‡æ–™åº«é€£æ¥å¤±æ•—

**éŒ¯èª¤**ï¼š`could not connect to server`

**è§£æ±ºæ–¹æ³•**ï¼š
```powershell
# æª¢æŸ¥ PostgreSQL æ˜¯å¦é‹è¡Œ
docker compose ps postgres

# æŸ¥çœ‹ PostgreSQL æ—¥èªŒ
docker compose logs postgres

# é‡å•Ÿ PostgreSQL
docker compose restart postgres
```

### å•é¡Œ 3ï¼šåŠ å¯†é‡‘é‘°éŒ¯èª¤

**éŒ¯èª¤**ï¼š`Invalid encryption key`

**è§£æ±ºæ–¹æ³•**ï¼š
1. é‡æ–°ç”ŸæˆåŠ å¯†é‡‘é‘°
2. æ›´æ–° `.env` æ–‡ä»¶
3. é‡å•Ÿæœå‹™

```powershell
python scripts/generate_encryption_key.py
# è¤‡è£½æ–°é‡‘é‘°åˆ° .env
docker compose restart backend
```

### å•é¡Œ 4ï¼šRedis é€£æ¥å¤±æ•—

**éŒ¯èª¤**ï¼š`Error connecting to Redis`

**è§£æ±ºæ–¹æ³•**ï¼š
```powershell
# æª¢æŸ¥ Redis æ˜¯å¦é‹è¡Œ
docker compose ps redis

# æ¸¬è©¦ Redis é€£æ¥
docker compose exec redis redis-cli ping
# æ‡‰è©²è¿”å› PONG

# é‡å•Ÿ Redis
docker compose restart redis
```

### å•é¡Œ 5ï¼šå®¹å™¨ç„¡æ³•å•Ÿå‹•

**è§£æ±ºæ–¹æ³•**ï¼š
```powershell
# æŸ¥çœ‹è©³ç´°éŒ¯èª¤
docker compose logs backend

# æ¸…ç†ä¸¦é‡æ–°æ§‹å»º
docker compose down -v
docker compose build --no-cache
docker compose up -d
```

## ç”Ÿç”¢ç’°å¢ƒéƒ¨ç½²

### å®‰å…¨æª¢æŸ¥æ¸…å–®

- [ ] ä¿®æ”¹ `.env` ä¸­çš„æ‰€æœ‰é è¨­å¯†ç¢¼
- [ ] ä½¿ç”¨å¼·åŠ å¯†é‡‘é‘°ï¼ˆè‡³å°‘ 32 å­—ç¯€ï¼‰
- [ ] è¨­å®š `DEBUG=False`
- [ ] é…ç½®é˜²ç«ç‰†è¦å‰‡
- [ ] å•Ÿç”¨ HTTPSï¼ˆä½¿ç”¨ Nginx åå‘ä»£ç†ï¼‰
- [ ] å®šæœŸå‚™ä»½è³‡æ–™åº«
- [ ] è¨­å®šæ—¥èªŒè¼ªè½‰
- [ ] é…ç½®ç›£æ§å’Œå‘Šè­¦

### æ¨è–¦çš„ç”Ÿç”¢ç’°å¢ƒé…ç½®

```yaml
# docker-compose.prod.yml
services:
  backend:
    environment:
      APP_ENV: production
      DEBUG: "False"
      LOG_LEVEL: WARNING
    restart: always
    deploy:
      resources:
        limits:
          cpus: '2'
          memory: 2G
```

å•Ÿå‹•ç”Ÿç”¢ç’°å¢ƒï¼š
```powershell
docker compose -f docker-compose.yml -f docker-compose.prod.yml up -d
```

## æ›´å¤šè³‡æº

- **å®Œæ•´æ–‡æª”**ï¼šæŸ¥çœ‹ `README.md`
- **API æ–‡æª”**ï¼šhttp://localhost:8000/docs
- **æ¶æ§‹èªªæ˜**ï¼šæŸ¥çœ‹ `ARCHITECTURE.md`
- **æ¸¬è©¦æ–‡æª”**ï¼šæŸ¥çœ‹ `backend/tests/README.md`
- **å¿«é€Ÿé–‹å§‹**ï¼šæŸ¥çœ‹ `QUICK_START.md`

## ç²å–å¹«åŠ©

å¦‚æœé‡åˆ°å•é¡Œï¼š

1. æŸ¥çœ‹æ—¥èªŒï¼š`docker compose logs -f backend`
2. æª¢æŸ¥æœå‹™ç‹€æ…‹ï¼š`docker compose ps`
3. æŸ¥çœ‹æ•…éšœæ’é™¤éƒ¨åˆ†
4. æŸ¥çœ‹ç›¸é—œæ–‡æª”

## ä¸‹ä¸€æ­¥

ç¾åœ¨ä½ å·²ç¶“çŸ¥é“å¦‚ä½•ä½¿ç”¨ç³»çµ±äº†ï¼å»ºè­°ï¼š

1. é–±è®€ `ARCHITECTURE.md` äº†è§£ç³»çµ±æ¶æ§‹
2. æŸ¥çœ‹ `API æ–‡æª”` äº†è§£æ‰€æœ‰å¯ç”¨ç«¯é»
3. é‹è¡Œæ¸¬è©¦ç¢ºä¿ç³»çµ±æ­£å¸¸å·¥ä½œ
4. æ ¹æ“šéœ€æ±‚è‡ªå®šç¾©é…ç½®

ç¥ä½¿ç”¨æ„‰å¿«ï¼ğŸš€
